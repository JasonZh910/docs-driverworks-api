
## RegisterEvents

Function to register the History event(s) that will be generated by a given driver, proxy or agent. This information is used to generate a hierarchical taxonomy by the History Agent to organize event filtering and notification triggering. 

As a driver developer, managing the user preferences for event notifications is completely independent of the driver. The driver’s only responsibility is to register the events and send the events.

Registered events will appear in the History Agent. The interface to that is found in Composer Pro. A curated selection of events are provided through the Navigator UI for the user to enable/disable for notifications. If your event shows up in the History agent but doesn’t show up in the Navigator, it’s likely that you’ll need to use one of the curated categories.

This API can be invoked in or after OnDriverLateInit. 

Note: If the method returns false, there is a possibility that the History Agent database is not initialized yet. Because of this, all failures activate a retry timer that will re-try the registration every 30 seconds. This is due to the order of driver late initialization. If this device runs OnDriverLateInit before the History Agent, the registration will fail.


###### Available from  3.4.0


### Signature

`C4:RegisterEvents()`


### Parameters

| Parameter | Description                                   |
| --------- | --------------------------------------------- |
| str       | XML string itemizing events to be registered. |


### Returns

| Value | Description                                                       |
| ----- | ----------------------------------------------------------------- |
| bool  | true if events are registered with history agent, false otherwise |



### Example

Note: The XML string should be HTML escaped to prevent XML processing errors. For example,  use &amp; instead of ampersand character(s) and &quot; instead of embedded quote character(s).


```
local EVENT\_CATEGORY = "Cameras"
local EVENT\_SUBCATEGORY = "IP Camera"
local EVENT\_TYPES = { motion = "Motion", button = "Doorbell Pressed" }
 
function RegisterDeviceEvents\_raw()
  local camera\_proxy\_id = (next(C4:GetBoundConsumerDevices(C4:GetDeviceID(), CAMERA\_PROXY\_BINDING\_ID)))
  --  local fqn = EVENT\_CATEGORY .. "\\/" .. EVENT\_SUBCATEGORY .. "\\/" .. camera\_proxy\_id  -- fqn is optional at this point, leaving it out for now...
 
  if (type(C4.RegisterEvents) == "function") then
local typelist = ""
for _, v in pairs(EVENT_TYPES) do
  typelist = typelist .. '<type name="' .. v .. '"/>'
end

if (typelist ~="") then
  local registerXML = '<events>' ..
                      '<device id="' .. camera_proxy_id .. '"/>' ..
                      --'<fqname="' .. fqn .. '"/>' ..
                      '<categories><category name="' .. EVENT_CATEGORY .. '">' ..
                      '<subcategories><subcategory name="' .. EVENT_SUBCATEGORY .. '">' ..
                      '<types>' .. typelist .. '</types></subcategory>' ..
                      '</subcategories></category></categories></events>'

  dbg("Registering Events...  XML: " .. registerXML)
  C4:RegisterEvents(registerXML)
end
 
  else
err_print("C4:RegisterEvents not found. Need at least Control4 OS version 3.4.x")
  end
end
RegisterDeviceEvents = pcall\_wrap(RegisterDeviceEvents\_raw, "RegisterDeviceEvents")
```


The second example shows results that can be used for validation purposes.


```
REGISTER\_EVENTS\_SUCCESS = 0
REGISTER\_EVENTS\_FAIL = -1
REGISTER\_EVENTS\_DISCONNECTED = -6
result = C4:RegisterEvents(events)
if result == REGISTER\_EVENTS\_SUCCESS then
LogInfo("Success.")
  elseif result == REGISTER\_EVENTS\_FAIL then
LogFatal("FATAL: Fail!")
  elseif result == REGISTER\_EVENTS\_DISCONNECTED then
LogWarn("WARNING: History Agent database is not initialized yet!")
  end
```