# lua-openssl Interface

Beginning with Operating System 3.4.1, a lua-openssl interface is supported through the SDK. Previously, new cryptographic functions were added to the DriverWorks API upon request. However, this approach is untenable as it is impossible to anticipate the future needs of drivers to perform cryptographic operations. Its inclusion ensures that drivers developers will have what they need without having to request new APIs in the future. 

Documentation for using the included lua-openssl library can be found [here][1].



The DriverWorks included lua-openssl library works according to the documentation above, with some exceptions.  The version of lua-openssl included in DriverWorks has been modified to remove deprecated OpenSSL calls, and to ensure that all file operations (i.e., create, open, etc.) occur relative to a well-known directory alias, similar to how other DriverWorks file functions operate. (See 'Working with Files' below)

In these cases, API functions have been removed or objects have been affected.  Affected functions and objects, along with their respective changes, are detailed in the table below.

|                        |                                                                                                                                                                                                                                                                                |
| :--------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Class or Module**    | **Modifications**                                                                                                                                                                                                                                                              |
| Class: **bio**         | All methods related to sockets were removed. This includes the following:                                                                                                                                                                                                      |
|                        | bio:shutdown                                                                                                                                                                                                                                                                   |
|                        | bio:accept                                                                                                                                                                                                                                                                     |
|                        | bio:connect                                                                                                                                                                                                                                                                    |
|                        | bio:get\_ssl                                                                                                                                                                                                                                                                   |
|                        | bio:handshake                                                                                                                                                                                                                                                                  |
| Module: **dh**         | The dh module was removed. This was done because the DH API was deprecated in OpenSSL 3 and will be removed in future versions. Use the pkey module  for operations involving DH keys.                                                                                         |
| Module: **dsa**        | The dsa module was removed. This was done because the DSA API was deprecated in OpenSSL 3 and will be removed in future versions. Use the pkey module  for operations involving DSA keys.                                                                                      |
| Module: **ec**         | The ec module was removed. This was done because the EC API was deprecated in OpenSSL 3 and will be removed in future versions. Use the pkey  instead for operations involving EC keys.                                                                                        |
| Class: **evp\_cipher** | The engine argument was removed from the  methods listed below. This was done due to the requirement of compiling  C (native) code, which is not permitted for Lua drivers.                                                                                                    |
|                        | evp\_cipher:cipher                                                                                                                                                                                                                                                             |
|                        | evp\_cipher:decrypt                                                                                                                                                                                                                                                            |
|                        | evp\_cipher:decrypt\_new                                                                                                                                                                                                                                                       |
|                        | evp\_cipher:encrypt                                                                                                                                                                                                                                                            |
|                        | evp\_cipher: encrypt\_new                                                                                                                                                                                                                                                      |
|                        | evp\_cipher:new                                                                                                                                                                                                                                                                |
| Module: **hmac**       | The engine argument was removed from the method  listed below. This was done due to the requirement of compiling  C (native) code, which is not permitted for Lua drivers. new                                                                                                 |
| Class: **lhash**       | All file operations (i.e., create, open, etc.) occur relative to a well-known directory alias. See Working With Files below for more information. The following methods are affected: lhash:read                                                                               |
| Module: **openssl**    | All file operations (i.e., create, open, etc.) occur relative to a well-known directory alias. See Working With Files below for more information. The following functions are affected:                                                                                        |
|                        | rand\_load                                                                                                                                                                                                                                                                     |
|                        | rand\_write                                                                                                                                                                                                                                                                    |
|                        | Functions related to managing engines were removed. This was done due to the requirement of compiling  C (native) code, which is not permitted for Lua drivers. The following function was removed: engine The following function  related to using FIPS modules were removed: |
|                        | FIPS\_mode                                                                                                                                                                                                                                                                     |
| Module: **pkey**       | Functions related to managing engines were modified. This was done due to the requirement of compiling  C (native) code, which is not permitted for Lua drivers.  The following functions are affected:                                                                        |
|                        | new (engine argument removed)                                                                                                                                                                                                                                                  |
|                        | set\_engine   (function removed)                                                                                                                                                                                                                                               |
| Class: **pkey**        | The engine argument was removed from the various methods. This was done due to the requirement of compiling  C (native) code, which is not permitted for Lua drivers. The following methods are affected: pkey:derive                                                          |
| Module: **rsa**        | The rsa module was removed. This was done because the RSA API was deprecated in OpenSSL 3 and will be removed in future versions. Use the pkey module for operations involving RSA keys.                                                                                       |
| Module: **ssl**        | The ssl module was removed. This was done because this module is designed for use with sockets that the OpenSSL socket API blocks.                                                                                                                                             |
| Module: **srp**        | The srp module was removed. This was done because the SRP API was deprecated in OpenSSL 3 and will be removed in future versions. There is no replacement for this API.                                                                                                        |
| Module: **x509.store** | All file operations (i.e., create, open, etc.) occur relative to a well-known directory alias. See Working With Files below for more information. The following functions are affected:                                                                                        |
|                        | add\_lookup                                                                                                                                                                                                                                                                    |
|                        | load                                                                                                                                                                                                                                                                           |



[1]:	https://zhaozg.github.io/lua-openssl/